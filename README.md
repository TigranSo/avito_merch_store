Автор: Тигран Согомонян

## Описание проекта
Это API для внутреннего магазина мерча в Avito. Сотрудники могут покупать товары (мерч) за монетки и передавать монетки друг другу. При первой аутентификации пользователь создаётся автоматически с начальным балансом 1000 монет.

## Функциональные возможности
- **Аутентификация:**  
  - Эндпоинт `/api/auth` принимает имя и пароль. Если пользователь не найден, создаётся новый с 1000 монетами. Возвращается JWT-токен.
  
- **Получение информации:**  
  - Эндпоинт `/api/info` возвращает текущий баланс монет, инвентарь (список купленных товаров) и историю переводов монет (отправленные и полученные).

- **Передача монет:**  
  - Эндпоинт `/api/sendCoin` позволяет отправить монеты другому пользователю, если средств достаточно.

- **Покупка мерча:**  
  - Эндпоинт `/api/buy/{item}` позволяет купить товар за монеты, списывая стоимость с баланса.

- **Список мерча:**  
  - Эндпоинт `/api/merch` возвращает список всех доступных товаров.

## Стек технологий
- **Язык:** Python 3.10  
- **Фреймворк:** FastAPI  
- **ORM:** SQLAlchemy  
- **База данных:** PostgreSQL (запускается через Docker)  
- **Аутентификация:** JWT (python-jose)  
- **Контейнеризация:** Docker, Docker Compose  
- **Тестирование:** pytest, pytest-cov

## Структура проекта
D:\avito\
├── docker-compose.yml
├── Dockerfile
├── requirements.txt
└── backend\
    └── app\
         ├── main.py
         ├── models.py
         ├── schemas.py
         ├── database.py
         └── routers\
             ├── auth.py
             ├── users.py
             ├── transactions.py
             └── merch.py

## Установка и запуск

1. **Клонируйте репозиторий:**

   ```bash
   git clone https://github.com/TigranSo/avito_merch_store.git
   cd your_repository

Создайте файл .env в корне проекта если его не будет(я его оставил там не хранится важные данные)
Содержимое файла:
DATABASE_URL=postgresql://admin:123@db/merch_store
SECRET_KEY=your_secret

Запустите Docker Compose:
docker-compose up --build

Контейнеры будут запущены:
db: PostgreSQL, доступен на порту 5432.
api: доступен на http://localhost:8080.
Проверьте работу API:

Откройте http://localhost:8080/docs – здесь находится документация Swagger UI, через которую можно протестировать эндпоинты.

Тестирование
Запустите тесты с использованием pytest:

Для теста нужно установть зависимости.

1. Создаем вир. окружение py venv -m env
2. Активация venv\Scripts\activate
3. Установка pip install -r requirements.txt
После чего можно запустить тесты 

pytest --maxfail=1 --disable-warnings -q --cov=backend

Тесты покрывают более 80 процентов проекта.

Проблемы и решения
При запуске API таблицы создавались автоматически в событии startup в файле backend/app/main.py:

@app.on_event("startup")
def on_startup():
    Base.metadata.create_all(bind=engine)
    # Инициализация мерча (если таблица пустая)
    ...
Это позволило избежать проблем с отсутствующими таблицами в базе.

В переменной окружения DATABASE_URL использовалось значение postgresql://admin:123@db/merch_store. Были проверены файлы .env и alembic.ini (если применяются) на корректную кодировку UTF-8, чтобы избежать ошибок Unicode.

Заключение
В репозитории содержится:

Код сервиса – все файлы проекта находятся в ветке main.
Docker Compose – файл docker-compose.yml готов к запуску. Инструкция по запуску описана в данном README.md.
